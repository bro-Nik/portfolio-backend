services:
  backend-db:
    extends:
      file: docker-compose.base.yml
      service: backend-db
    container_name: backend-db-test
    networks:
      - backend-net

  backend-test:
    extends:
      file: docker-compose.base.yml
      service: backend
    build:
      context: .
      dockerfile: Dockerfile.test
    environment:
      TEST_DATABASE_URL: postgresql+asyncpg://${DB_USER:-user}:${DB_PASSWORD:-pass}@backend-db/${DB_NAME:-db}
      JWT_SECRET: test_secret_key_1234567890123456789
    container_name: backend-test
    volumes:
      - ./app:/app/app
      - ./tests:/app/tests
      - ./requirements.txt:/app/requirements.txt
      - ./requirements-test.txt:/app/requirements-test.txt
      - ./reports:/app/reports
    networks:
      - backend-net
    command: ["pytest"]

networks:
  backend-net:
    driver: bridge

volumes:
  db_data:
  reports:
